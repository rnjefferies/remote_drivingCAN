Configure and debug tod_pix_bridge nodes using vcan0
-----------------------------------------------------
Ryan Jefferies
=============================
Testing Vehicle Data Recevier
=============================

++++++++++ SPEED ++++++++++++
Node: VehicleDataFromCanNode 
tod_msg: longitudinalSpeed 
---------------------------
CAN Protocol
---------------------------
ID: 193
Signal position: 1st and 2nd bytes
Signal length: 16 bits
Signal definition: Vehicle speed feedback
Min value -600
Max value 600
Unit: 0.1km/h

----------------------------------------------
Test hex to include in byte 1 and 2 of cansend
---------------------------------------------- 
Hex = signed decimal conversion
FDA8 = -600
FED4 = -300
FF22 = -222
FFEA = -22
0000 = 0
0021 = 33
014D = 333
0190 = 400
0258 = 600
-----------------------------------------------
++++++++++ STEERING +++++++++++
Node: VehicleDataFromCanNode
tod_msg: steeringWheelAngle

CAN Protocol
------------------------------------------------
ID: 193
Signal position: 3rd and 4th bytes
Signal length: 16 bits
Signal definition: Steering angle feedback of front steering motor
Offset: 750
Min value 650
Max value 850
----------------------------------------------
Test hex to include in byte 3 and 4 of cansend
---------------------------------------------- 
Hex = decimal conversion
028A = 650
02DD = 733
0320 = 800
0337 = 823
0352 = 850
-----------------------------------------------
+++++++++ GEAR +++++++++++++
Node: VehicleDataFromCanNode
tod_msg: gearPostion

CAN Protocol
------------------------------------------------
ID: 193
Signal position: first 2 bits of byte 7
Signal length: 2 bits
Signal definition: current gearing
Gear Drive: 0x1
Gear Neutral: 0x2
Gear Reverse: 0x3

Test hex to include in byte 7 cansend
---------------------------------------------- 
Hex = conversion
40 = 1
80 = 2 
C0 = 3 


Testing a CAN Frame using cansend vcan0
----------------------------------------------
cansend vcan0 193#002103200000C000 
= velocity: 33, angle: 800, gear: Reverse


-------------------------------------------------
=================================================
Testing Control Commands
=================================================
------------------------
+++++++ VELOCITY ++++++++++
Node: ControlCmdToCan
tod_msg: velocity: 0-10
-------------------------------------------------
Can Protocol 
-------------------------------------------------
ID: 183
Signal position: Byte 1 and byte 2
Signal length: 16 bits
Signal definition: Speed value
Min/max: 0-600 km/h (unit 0.1)

Test input from device 
<rostopic echo /Vehicle/VehicleBridge/primary_control_cmd>
--------------------------------------------------
velocity: 10.0 (maxium input)

Output on candump <candump vcan0>
--------------------------------------------------
vcan0  00000183   [8]  02 58 00 00 00 00 40 00

Output conversion
--------------------------------------------------
Hex    Speed value
0258   600 

----------------------------------------------------------
----------------------------------------------------------

++++++++ STEERING WHEEL ANGLE ++++++++
Node: ControlCmdToCan
tod_msg: steeringWheelAngle -7.85 to 7.85 (radians) left is positive, right negative
-------------------------------------------------
Can Protocol 
-------------------------------------------------
ID: 183
Signal position: Byte 5 and byte 6
Signal length: 16 bits
Signal definition: Steering value
Min/max: -1024 to 1024 with offset of 1024 left turn is negative, right turn is positive 
NOTE: steering range needs to be inverted, standardised and transformed 
before offset is applied (hard left = 0 hard right = 2048)

TEST 1 input from device 
<rostopic echo /Vehicle/VehicleBridge/primary_control_cmd>
--------------------------------------------------
--------------------------------------------------
steeringWheelAngle: -7.853799819946289 (max right turn)

Output on candump <candump vcan0>
--------------------------------------------------
vcan0  00000183   [8]  00 00 00 00 08 00 00 00
                                   ----- bytes 5 and 6

Output conversion
--------------------------------------------------
Hex    Steering value
0800   2048 

TEST 2 input from device 
<rostopic echo /Vehicle/VehicleBridge/primary_control_cmd>
--------------------------------------------------
--------------------------------------------------
steeringWheelAngle: 7.853799819946289 (max left turn)

Output on candump <candump vcan0>
--------------------------------------------------
vcan0  00000183   [8]  00 00 00 00 00 00 00 00
                                   ----- bytes 5 and 6

Output conversion
--------------------------------------------------
Hex    Steering value
0000   0 

TEST 3 input from device 
<rostopic echo /Vehicle/VehicleBridge/primary_control_cmd>
--------------------------------------------------
--------------------------------------------------
steeringWheelAngle: -0.0 (no turning input)

Output on candump <candump vcan0>
--------------------------------------------------
vcan0  00000183   [8]  00 00 00 00 04 00 00 00
                                   ----- bytes 5 and 6

Output conversion
--------------------------------------------------
Hex    Steering value
0400   1024

TEST 4 input from device 
<rostopic echo /Vehicle/VehicleBridge/primary_control_cmd>
--------------------------------------------------
--------------------------------------------------
steeringWheelAngle: -3.85343599319458 (slight right)

Output on candump <candump vcan0>
--------------------------------------------------
vcan0  00000183   [8]  00 00 00 00 05 F6 00 00
                                   ----- bytes 5 and 6

Output conversion
--------------------------------------------------
Hex    Steering value
05F6   1526
----------------------------------------------------
-----------------------------------------------------

+++++++++ BRAKING +++++++++++
Node: ControlCmdToCan
tod_msg: acceleration (braking) -8.25 to 3.40 

Can Protocol 
-------------------------------------------------
ID: 183
Signal position: Byte 3 and byte 4
Signal length: 16 bits
Signal definition: Braking value
Range: 0 to 1024
(Note: The braking value cannot be sent for a long time (more than 1 minute) 
with a value exceeding 800. When it is necessary to stop for a longer period,
electronic parking should be used, otherwise irreversible damage will be 
conducted onto the brake motors)

Conversion: The range of acceleration score had to be scaled and transformed 
so that only the negative values are sent as brake commands. 

TEST 1 input from device 
<rostopic echo /Vehicle/VehicleBridge/primary_control_cmd>
--------------------------------------------------
--------------------------------------------------
acceleration: -0.5537689924240112

Output on candump <candump vcan0>
--------------------------------------------------
vcan0  00000183   [8]  00 00 00 42 04 00 40 10
                             ----- bytes 3 and 4

Hex   Braking value
0042  66   

TEST 2 input from device 
<rostopic echo /Vehicle/VehicleBridge/primary_control_cmd>
--------------------------------------------------
--------------------------------------------------
acceleration: -8.550000190734863

Output on candump <candump vcan0>
--------------------------------------------------
vcan0  00000183   [8]  00 00 04 00 04 00 40 10
                             ----- bytes 3 and 4

Hex   Braking value
0400  1024   